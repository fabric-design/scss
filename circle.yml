machine:
  timezone:
    Europe/Berlin
  node:
    version: 7.8.0
  environment:
    TARGET: $(test "${CIRCLE_BRANCH}" == "master" && echo "" || echo "${CIRCLE_PROJECT_REPONAME}/${CIRCLE_BRANCH}")

general:
  branches:
    ignore:
      - gh-pages

checkout:
  post:
    - git clone https://${STYLEGUIDE_TOKEN}@github.com/wholesale-design-system/styleguide.git -b travis

dependencies:
  override:
    - npm install -g gulp-cli aurelia-cli
    - npm install

compile:
  override:
    - gulp sass

test:
  override:
    - gulp lint-sass

deployment:
  master:
    branch: /.*/
    commands:
      - cd styleguide; \
        npm install && npm link ../; \
        ls -la scripts && ls -la src/app; \
        au build;\
        ls -la scripts;\
        au publish --commit "${CIRCLE_SHA1}" --repo "${CIRCLE_PROJECT_REPONAME}/${CIRCLE_BRANCH}" --target "${TARGET}";



